{"note":"Don't delete this file! It's used internally to help with page regeneration.","name":"stripe_event","google":"","body":"## stripe_event\r\n\r\n[![Build Status](https://secure.travis-ci.org/integrallis/stripe_event.png?branch=master)](http://travis-ci.org/integrallis/stripe_event)\r\n\r\nstripe_event is built on the [ActiveSupport::Notifications API](http://api.rubyonrails.org/classes/ActiveSupport/Notifications.html). Incoming webhook requests are authenticated by retrieving the [event object](https://stripe.com/docs/api?lang=ruby#event_object) from Stripe[[1]](https://answers.stripe.com/questions/what-is-the-recommended-way-to-authenticate-a-webhook-callback). Define subscriber blocks to handle one, many, or all event types.\r\n\r\n## Install\r\n\r\n```ruby\r\n# Gemfile\r\ngem 'stripe_event'\r\n```\r\n\r\n```ruby\r\n# config/routes.rb\r\nmount StripeEvent::Engine => '/my-chosen-path' # provide a custom path\r\n```\r\n\r\n## Usage\r\n\r\n```ruby\r\n# config/initializers/stripe.rb\r\nStripe.api_key = ENV['STRIPE_API_KEY'] # Set your api key\r\n\r\nStripeEvent.setup do\r\n  subscribe 'charge.failed' do |event|\r\n    # Define subscriber behavior based on the event object\r\n    event.class #=> Stripe::Event\r\n    event.type  #=> \"charge.failed\"\r\n    event.data  #=> { ... }\r\n  end\r\n\r\n  subscribe 'customer.created', 'customer.updated' do |event|\r\n    # Handle multiple event types\r\n  end\r\n\r\n  subscribe do |event|\r\n    # Handle all event types - logging, etc.\r\n  end\r\nend\r\n```\r\n\r\n## Configuration\r\n\r\nIf you have built an application that has multiple Stripe accounts--say, each of your customers has their own--you may want to define your own way of retrieving events from Stripe (e.g. perhaps you want to use the [user_id parameter](https://stripe.com/docs/apps/getting-started#webhooks) from the top level to detect the customer for the event, then grab their specific API key). You can do this:\r\n\r\n```ruby\r\nStripeEvent.event_retriever = Proc.new do |params| \r\n  secret_key = Account.find_by_stripe_user_id(params[:user_id]).secret_key\r\n  Stripe::Event.retrieve(params[:id], secret_key)\r\nend\r\n```\r\n\r\nDuring development it may be useful to skip retrieving the event from Stripe, and deal with the params hash directly. Just remember that the data has not been authenticated.\r\n\r\n```ruby\r\nStripeEvent.event_retriever = Proc.new { |params| params }\r\n```\r\n\r\n### Register webhook url with Stripe\r\n\r\n![Setup webhook url](https://raw.github.com/integrallis/stripe_event/master/screenshots/dashboard-webhook.png \"webhook setup\")\r\n\r\n### Examples\r\n\r\nThe [RailsApps](https://github.com/RailsApps) project by Daniel Kehoe has released an [example Rails 3.2 app](https://github.com/RailsApps/rails-stripe-membership-saas) with recurring billing using Stripe. The application uses stripe_event to handle `customer.subscription.deleted` events.\r\n\r\n### Note: 'Test Webhooks' Button on Stripe Dashboard\r\n\r\nThis button sends an example event to your webhook urls, including an `id` of `evt_00000000000000`. To confirm that Stripe sent the webhook, stripe_event attempts to retrieve the event details from Stripe using the given `id`. In this case the event does not exist and stripe_event responds with `401 Unauthorized`. Instead of using the 'Test Webhooks' button, trigger webhooks by using the Stripe Dashboard to create test payments, customers, etc.\r\n","tagline":"Stripe webhook integration for Rails applications."}